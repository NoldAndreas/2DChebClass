classdef BigSegmentAlternative < M1SpectralSpectral
    properties
        R,h,Origin
    end
    
    methods
        function this = BigSegmentAlternative(Geometry)
            this@M1SpectralSpectral(Geometry.N(1),Geometry.N(2));
            
            this.Origin = Geometry.Origin;
            this.R      = Geometry.R;
            this.h      = Geometry.h;
            
            InitializationPts(this);
        end
        
                
        %***************************************************************
        %   Mapping functions:
        %***************************************************************             
        function [y1_kv,y2_kv,J,dH1,dH2] = PhysSpace(this,x1,x2)        
            n  = length(x1);

            C1      = (this.R+this.h)/2;

            y2H_kv  = (1+x2)*C1 - this.h;
            y2_kv   = this.Origin(2) + y2H_kv;

            g       = sqrt(this.R^2-y2H_kv.^2);

            dgdx2   = -C1*y2H_kv./(sqrt(this.R^2-y2H_kv.^2));
            dgdx2(isinf(dgdx2)) = 0;
            ddgddx2 = -C1^2*this.R^2./((this.R^2-y2H_kv.^2).^(3/2));

            y1_kv   = this.Origin(1) + x1.*g;

            if(nargout >= 3)
                J        = zeros(n,2,2);
                J(:,1,1) = g;
                J(:,1,2) = x1.*dgdx2;              
                J(:,2,2) = C1*ones(n,1);
            end

            if(nargout >= 4)
                dH1        = zeros(n,2,2);                 
                dH1(:,1,2) = dgdx2;
                dH1(:,2,1) = dgdx2;
                dH1(:,2,2) = ddgddx2;
            end

            if(nargout >= 4)
                dH2        = zeros(n,2,2);
            end

        end
        function [x1,x2] = CompSpace(this,y1,y2)
            exc = MException('BigSegmentAlternative:CompSpace','not yet implemented');
            throw(exc);
        end
    end          
        
end
