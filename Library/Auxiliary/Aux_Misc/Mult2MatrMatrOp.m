function C = Mult2MatrMatrOp(A1,B,A2)
%C = A1*B*A2
    [p,h1,h2] = size(B);
        
    %1st Step: A1*B
    w = zeros(p,p,2,2);
    w(:,:,1,1) = diag(A1(:,1,1))*B(:,:,1,1) + diag(A1(:,1,2))*B(:,:,2,1);
    w(:,:,1,2) = diag(A1(:,1,1))*B(:,:,1,2) + diag(A1(:,1,2))*B(:,:,2,2);
    w(:,:,2,1) = diag(A1(:,2,1))*B(:,:,1,1) + diag(A1(:,2,2))*B(:,:,2,1);
    w(:,:,2,2) = diag(A1(:,2,1))*B(:,:,1,2) + diag(A1(:,2,2))*B(:,:,2,2);
    
    %2nd Steo: (A1*B)*A2
    C = zeros(p,p,2,2);
    C(:,:,1,1) = diag(A2(:,1,1))*w(:,:,1,1) + diag(A2(:,2,1))*w(:,:,1,2);    
    C(:,:,1,2) = diag(A2(:,1,2))*w(:,:,1,1) + diag(A2(:,2,2))*w(:,:,1,2);
    C(:,:,2,1) = diag(A2(:,1,1))*w(:,:,2,1) + diag(A2(:,2,1))*w(:,:,2,2);
    C(:,:,2,2) = diag(A2(:,1,2))*w(:,:,2,1) + diag(A2(:,2,2))*w(:,:,2,2);    
    
end